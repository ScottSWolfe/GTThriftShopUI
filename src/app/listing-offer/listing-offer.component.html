<mat-expansion-panel class="offer-panel">
  <mat-expansion-panel-header>
    <mat-panel-title *ngIf="showUser || showListing">
      <a *ngIf="showListing" routerLink="/listings/{{listing._id}}">{{listing.name}}</a>
      <b *ngIf="showUser && showListing">&nbsp;-&nbsp;</b>
      <a *ngIf="showUser" routerLink="/users/{{offer.user._id}}">
        {{offer?.user?.firstName}} {{offer?.user?.lastName}}
      </a>
    </mat-panel-title>
    <mat-panel-description class="offer-panel-price">$ {{offer.price}}</mat-panel-description>
  </mat-expansion-panel-header>
  <div class="offer-message" *ngFor="let message of offer.messages; let i = index"
       [ngStyle]="{'margin-top': i === 0 ? '0' : '12px'}">
    <span class="offer-message-name" *ngIf="offer.user">
      <span *ngIf="offer.user._id === message.author; else authorIsListingOwner">
        {{offer?.user?.firstName}} {{offer?.user?.lastName}}:
      </span>
      <ng-template #authorIsListingOwner>
        {{listing?.user?.firstName}} {{listing?.user?.lastName}}:
      </ng-template>
    </span>
    <span>{{message.text}}</span>
  </div>
  <span *ngIf="offer.messages.length === 0">No messages yet</span>
  <form class="offer-panel-message-form">
    <mat-form-field class="offer-panel-message-field">
      <input matInput required placeholder="Message" type="text" title="Message" name="message" [(ngModel)]="message"
             (keyup.enter)="onSubmit()">
      <mat-error>Please enter a message.</mat-error>
    </mat-form-field>
    <button mat-raised-button id="button-post-message" color="primary" (click)="onSubmit()"
            [disabled]="submitDisabled">
      Post
    </button>
  </form>
</mat-expansion-panel>
